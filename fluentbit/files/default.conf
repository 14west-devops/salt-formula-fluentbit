{%- from "fluentbit/map.jinja" import fluentbit with context -%}
{%- for sec,conf in config.iteritems() %}

[{{ conf.get('section', section)|upper }}]
{#- render name, if not SERVICE sec #}
  {%- if section.upper() != 'SERVICE' %}
  Name {{ conf.get('name', sec) }}
  {%- endif %}
{#- render configuration #}
  {%- for option,value in conf.iteritems() %}
  {%- if option == 'name' %}{% continue %}{% endif %}
  {%- if option == 'section' %}{% continue %}{% endif %}
{#- transform "log_level" to camel case Log_Level -#}
    {%- set option_name = [] %}
    {%- for o in option.split('_') -%} {%- do option_name.append(o[0].upper() + o[1:]) -%} {%- endfor %}
  {%- if value is list %}
  {%- for v in value %}
  {{ option_name|join("_") }} {{ v }}
  {%- endfor %}
  {%- else %}
  {{ option_name|join("_") }} {{ value }}
  {%- endif %}
  {%- endfor %}
{%- endfor %}
